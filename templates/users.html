<!DOCTYPE html>
<html>
<head>
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<nav>
    <div class="logo"><strong>IPTV Manager</strong></div>
    <div class="links">
        <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/playlists">–ú–æ–∏ –ø–ª–µ–π–ª–∏—Å—Ç—ã</a>
        <a href="/profile">–ü—Ä–æ—Ñ–∏–ª—å</a>
        {% if user.is_admin %}
        <a href="/users">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
        {% endif %}
        <a href="/logout">–í—ã—Ö–æ–¥</a>
    </div>
</nav>

<div class="container">
    <h2>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>

    <form method="post" action="/users" onsubmit="return validateForm()">
        <div class="form-group">
            <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
            <input type="text" name="username" required minlength="3" maxlength="50">
        </div>
        <div class="form-group">
            <label>–ü–∞—Ä–æ–ª—å:</label>
            <input type="password" name="password" required minlength="6">
        </div>
        <div class="form-group">
            <label>
                <input type="checkbox" name="is_admin" value="true"> –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
            </label>
        </div>
        <button type="submit" class="btn btn-primary">‚ûï –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
    </form>

    <hr>

    <h3>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
    {% if users %}
    <table>
        <thead>
        <tr>
            <th>ID</th>
            <th>–ò–º—è</th>
            <th>–¢–∏–ø</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        </thead>
        <tbody>
        {% for u in users %}
        <tr>
            <td>{{ u.id }}</td>
            <td>{{ u.username }}</td>
            <td>
                {% if u.is_admin %}
                <span class="btn btn-admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                {% else %}
                –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                {% endif %}
            </td>
            <td>
                {% if not u.is_admin %}
                <button class="btn btn-danger" onclick="deleteUser({{ u.id }})">–£–¥–∞–ª–∏—Ç—å</button>
                {% else %}
                <span class="admin-only">–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>–ù–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</p>
    {% endif %}
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
<div id="successModal" class="modal">
    <div class="modal-content">
        <h3>‚úÖ –£—Å–ø–µ—à–Ω–æ!</h3>
        <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω</p>
        <button class="modal-btn" onclick="closeModal()">–î–∞–ª–µ–µ</button>
    </div>
</div>

<script>
    function validateForm() {
        const username = document.querySelector("input[name='username']").value;
        if (username.includes(' ')) {
            alert("–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–±–µ–ª–æ–≤");
            return false;
        }
        return true;
    }

    async function deleteUser(userId) {
        if (!confirm("–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.")) return;

        try {
            const res = await fetch(`/users/${userId}`, {
                method: 'DELETE'
            });
            if (res.ok) {
                location.reload();
            } else {
                const data = await res.json();
                alert('–û—à–∏–±–∫–∞: ' + data.detail);
            }
        } catch (err) {
            alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + err.message);
        }
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('created') === 'true') {
        document.getElementById('successModal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('successModal').style.display = 'none';
        window.location.href = '/users'; // –û—Å—Ç–∞–µ–º—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    }
</script>
</body>
</html>